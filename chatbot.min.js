// document.addEventListener("DOMContentLoaded", () => { const e = document.getElementById("chatContainer"), t = document.getElementById("chatMessages"), n = document.getElementById("userInput"), a = document.getElementById("sendButton"), s = document.getElementById("chatWidgetButton"), c = document.getElementById("closeButton"); function o(e, n = !1) { const a = document.createElement("div"); a.className = n ? "message user-message" : "message bot-message", a.innerHTML = `<p>${n ? e.replace(/\n/g, "<br>") : e}</p>`, t.appendChild(a), t.scrollTop = t.scrollHeight } async function i(e) { try { const t = await fetch("https://chatbot-q8b5.onrender.com/api/chat", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ input_value: e, output_type: "chat", input_type: "chat" }) }), n = await t.json(); return console.log("Data is:", n.result), "object" == typeof n.result && n.result && n.result[0].outputs[0].messages[0].message ? n.result[0].outputs[0].messages[0].message : n.result } catch (e) { return console.error("API Error:", e), "Oops! Something went wrong while contacting the server." } } function l(e) { const n = e.split("\n").filter(e => e.trim().startsWith("|")), a = []; for (let e = 2; e < n.length; e++) { const s = n[e].split("|").map(e => e.trim()), c = s[1]?.replace(/\*\*/g, "") || "", o = s[2]?.replace(/\*\*/g, "") || ""; c && o && a.push(`<strong>${c}</strong><br>${o}`) } return a.join("<br><br>") } async function d() { const e = n.value.trim(); if ("" !== e) { o(e, !0), n.value = ""; const a = document.createElement("div"); a.className = "message bot-message", a.innerHTML = "<p>Typing...</p>", t.appendChild(a), t.scrollTop = t.scrollHeight; const s = await i(e), c = l(s); t.removeChild(a), o(c) } } s.addEventListener("click", () => { e.classList.add("active"), n.focus() }), c.addEventListener("click", () => { e.classList.remove("active") }), a.addEventListener("click", d), n.addEventListener("keypress", e => { "Enter" === e.key && d() }) });

// document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("chatContainer"),t=document.getElementById("chatMessages"),n=document.getElementById("userInput"),a=document.getElementById("sendButton"),s=document.getElementById("chatWidgetButton"),c=document.getElementById("closeButton");function o(e,n=!1){const a=document.createElement("div");a.className=n?"message user-message":"message bot-message",a.innerHTML=`<p>${n?e.replace(/\n/g,"<br>"):e}</p>`,t.appendChild(a),t.scrollTop=t.scrollHeight}async function i(e){try{const a="https://chatbot-q8b5.onrender.com/api/chat";console.log("Sending request to:",a);const t=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({input_value:e,output_type:"chat",input_type:"chat"})}),n=await t.json();return console.log("Response received:",n),typeof n.result=="object"&&n.result?.[0]?.outputs?.[0]?.messages?.[0]?.message?n.result[0].outputs[0].messages[0].message:n.result}catch(e){return console.error("API Error:",e),"Oops! Something went wrong while contacting the server."}}function l(e){const n=e.split("\n").filter(e=>e.trim().startsWith("|")),a=[];for(let e=2;e<n.length;e++){const s=n[e].split("|").map(e=>e.trim()),c=s[1]?.replace(/\*\*/g,"")||"",o=s[2]?.replace(/\*\*/g,"")||"";c&&o&&a.push(`<strong>${c}</strong><br>${o}`)}return a.join("<br><br>")}async function d(){const e=n.value.trim();if(e!==""){o(e,!0),n.value="";const a=document.createElement("div");a.className="message bot-message",a.innerHTML="<p>Typing...</p>",t.appendChild(a),t.scrollTop=t.scrollHeight;const s=await i(e),c=l(s);t.removeChild(a),o(c)}}s.addEventListener("click",()=>{e.classList.add("active"),n.focus()}),c.addEventListener("click",()=>{e.classList.remove("active")}),a.addEventListener("click",d),n.addEventListener("keypress",e=>{"Enter"===e.key&&d()})});

// document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("chatContainer"),t=document.getElementById("chatMessages"),n=document.getElementById("userInput"),a=document.getElementById("sendButton"),s=document.getElementById("chatWidgetButton"),c=document.getElementById("closeButton");function o(e,n=!1){const a=document.createElement("div");a.className=n?"message user-message":"message bot-message",a.innerHTML=`<p>${n?e.replace(/\n/g,"<br>"):e}</p>`,t.appendChild(a),t.scrollTop=t.scrollHeight}async function i(e){try{const a="https://chatbot-q8b5.onrender.com/api/chat";console.log("Sending request to:",a);const t=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({input_value:e,output_type:"chat",input_type:"chat"})}),n=await t.json();return console.log("Response received:",n),typeof n.result=="object"&&n.result?.[0]?.outputs?.[0]?.messages?.[0]?.message?n.result[0].outputs[0].messages[0].message:n.result}catch(e){return console.error("API Error:",e),"Oops! Something went wrong while contacting the server."}}function l(e){const n=e.split("\n").filter(e=>e.trim().startsWith("|")),a=[];for(let e=2;e<n.length;e++){const s=n[e].split("|").map(e=>e.trim()),c=s[1]?.replace(/\*\*/g,"")||"",o=s[2]?.replace(/\*\*/g,"")||"";c&&o&&a.push(`<strong>${c}</strong><br>${o}`)}return a.join("<br><br>")}async function d(){const e=n.value.trim();if(e!==""){o(e,!0),n.value="";const a=document.createElement("div");a.className="message bot-message",a.innerHTML="<p>Typing...</p>",t.appendChild(a),t.scrollTop=t.scrollHeight;const s=await i(e);t.removeChild(a);let c;c=s&&s.trim().startsWith("|")?l(s):s;o(c)}}s.addEventListener("click",()=>{e.classList.add("active"),n.focus()}),c.addEventListener("click",()=>{e.classList.remove("active")}),a.addEventListener("click",d),n.addEventListener("keypress",e=>{"Enter"===e.key&&d()})});
document.addEventListener("DOMContentLoaded", () => {
    const e = document.getElementById("chatContainer"),
        t = document.getElementById("chatMessages"),
        n = document.getElementById("userInput"),
        a = document.getElementById("sendButton"),
        s = document.getElementById("chatWidgetButton"),
        c = document.getElementById("closeButton");

    // Function to display message
    function o(e, n = false) {
        const a = document.createElement("div");
        a.className = n ? "message user-message" : "message bot-message";
        a.innerHTML = `<p>${n ? e.replace(/\n/g, "<br>") : e}</p>`;
        t.appendChild(a);
        t.scrollTop = t.scrollHeight;
    }

    // Function to handle API request
    async function i(e) {
        try {
            const a = "https://chatbot-q8b5.onrender.com/api/chat";
            console.log("Sending request to:", a);
            const t = await fetch(a, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ input_value: e, output_type: "chat", input_type: "chat" }),
            });
            const n = await t.json();
            console.log("Response received:", n);
            return typeof n.result == "object" && n.result?.[0]?.outputs?.[0]?.messages?.[0]?.message
                ? n.result[0].outputs[0].messages[0].message
                : n.result;
        } catch (e) {
            return console.error("API Error:", e), "Oops! Something went wrong while contacting the server.";
        }
    }

    // Function to convert pipe-separated text into HTML table
    function l(e) {
        const n = e.split("\n").filter(e => e.trim().startsWith("|"));
        let tableHTML = "<table border='1' style='width:100%; border-collapse: collapse;'>";

        // Adding table headers
        tableHTML += "<tr>";
        const headers = n[0].split("|").map(e => e.trim());
        headers.forEach(header => {
            tableHTML += `<th style='padding: 8px; text-align: left;'>${header}</th>`;
        });
        tableHTML += "</tr>";

        // Adding table rows
        for (let i = 2; i < n.length; i++) {
            const row = n[i].split("|").map(e => e.trim());
            tableHTML += "<tr>";
            row.forEach(cell => {
                tableHTML += `<td style='padding: 8px;'>${cell.replace(/\*\*/g, "")}</td>`; // Remove bold markdown
            });
            tableHTML += "</tr>";
        }

        tableHTML += "</table>";
        return tableHTML;
    }

    // Function to send user input and receive bot response
    async function d() {
        const e = n.value.trim();
        if (e !== "") {
            o(e, true);
            n.value = "";
            const a = document.createElement("div");
            a.className = "message bot-message";
            a.innerHTML = "<p>Typing...</p>";
            t.appendChild(a);
            t.scrollTop = t.scrollHeight;
            const s = await i(e);
            t.removeChild(a);
            let c;
            c = s && s.trim().startsWith("|") ? l(s) : s;
            o(c);
        }
    }

    // Event listeners for chat UI interactions
    s.addEventListener("click", () => {
        e.classList.add("active");
        n.focus();
    });

    c.addEventListener("click", () => {
        e.classList.remove("active");
    });

    a.addEventListener("click", d);

    n.addEventListener("keypress", e => {
        if ("Enter" === e.key) d();
    });
});
